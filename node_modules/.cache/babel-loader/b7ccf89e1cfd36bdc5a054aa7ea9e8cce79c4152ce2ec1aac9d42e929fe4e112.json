{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createMarketBuyOrder = exports.buildMarketBuyOrderCreationArgs = exports.getMarketBuyOrderRawAmounts = exports.createOrder = exports.buildOrderCreationArgs = exports.getOrderAmounts = exports.buildOrder = void 0;\nconst tslib_1 = require(\"tslib\");\nconst units_1 = require(\"@ethersproject/units\");\nconst order_utils_1 = require(\"@polymarket/order-utils\");\nconst types_1 = require(\"../types\");\nconst utilities_1 = require(\"../utilities\");\n/**\n * Generate and sign a order\n *\n * @param signer\n * @param contractAddress ctf exchange contract address\n * @param chainId\n * @param OrderData\n * @returns SignedOrder\n */\nconst buildOrder = (signer, contractAddress, chainId, orderData) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {\n  const cTFExchangeOrderBuilder = new order_utils_1.ExchangeOrderBuilder(contractAddress, chainId, signer);\n  return cTFExchangeOrderBuilder.buildSignedOrder(orderData);\n});\nexports.buildOrder = buildOrder;\nconst getOrderAmounts = (side, size, price) => {\n  const rawPrice = (0, utilities_1.roundNormal)(price, 2);\n  if (side === types_1.Side.BUY) {\n    // force 2 decimals places\n    const rawTakerAmt = (0, utilities_1.roundDown)(size, 2);\n    let rawMakerAmt = rawTakerAmt * rawPrice;\n    if ((0, utilities_1.decimalPlaces)(rawMakerAmt) > 4) {\n      rawMakerAmt = (0, utilities_1.roundUp)(rawMakerAmt, 8);\n      if ((0, utilities_1.decimalPlaces)(rawMakerAmt) > 4) {\n        rawMakerAmt = (0, utilities_1.roundDown)(rawMakerAmt, 4);\n      }\n    }\n    return {\n      side: order_utils_1.Side.BUY,\n      rawMakerAmt,\n      rawTakerAmt\n    };\n  } else {\n    const rawMakerAmt = (0, utilities_1.roundDown)(size, 2);\n    let rawTakerAmt = rawMakerAmt * rawPrice;\n    if ((0, utilities_1.decimalPlaces)(rawTakerAmt) > 4) {\n      rawTakerAmt = (0, utilities_1.roundUp)(rawTakerAmt, 8);\n      if ((0, utilities_1.decimalPlaces)(rawTakerAmt) > 4) {\n        rawTakerAmt = (0, utilities_1.roundDown)(rawTakerAmt, 4);\n      }\n    }\n    return {\n      side: order_utils_1.Side.SELL,\n      rawMakerAmt,\n      rawTakerAmt\n    };\n  }\n};\nexports.getOrderAmounts = getOrderAmounts;\n/**\n * Translate simple user order to args used to generate Orders\n */\nconst buildOrderCreationArgs = (signer, maker, signatureType, userOrder) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {\n  const {\n    side,\n    rawMakerAmt,\n    rawTakerAmt\n  } = (0, exports.getOrderAmounts)(userOrder.side, userOrder.size, userOrder.price);\n  const makerAmount = (0, units_1.parseUnits)(rawMakerAmt.toString(), order_utils_1.COLLATERAL_TOKEN_DECIMALS).toString();\n  const takerAmount = (0, units_1.parseUnits)(rawTakerAmt.toString(), order_utils_1.CONDITIONAL_TOKEN_DECIMALS).toString();\n  let taker;\n  if (typeof userOrder.taker !== \"undefined\" && userOrder.taker) {\n    taker = userOrder.taker;\n  } else {\n    taker = \"0x0000000000000000000000000000000000000000\";\n  }\n  let feeRateBps;\n  if (typeof userOrder.feeRateBps !== \"undefined\" && userOrder.feeRateBps) {\n    feeRateBps = userOrder.feeRateBps.toString();\n  } else {\n    feeRateBps = \"0\";\n  }\n  let nonce;\n  if (typeof userOrder.nonce !== \"undefined\" && userOrder.nonce) {\n    nonce = userOrder.nonce.toString();\n  } else {\n    nonce = \"0\";\n  }\n  return {\n    maker,\n    taker,\n    tokenId: userOrder.tokenID,\n    makerAmount,\n    takerAmount,\n    side,\n    feeRateBps,\n    nonce,\n    signer,\n    expiration: (userOrder.expiration || 0).toString(),\n    signatureType\n  };\n});\nexports.buildOrderCreationArgs = buildOrderCreationArgs;\nconst createOrder = (eoaSigner, chainId, signatureType, funderAddress, userOrder) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {\n  const eoaSignerAddress = yield eoaSigner.getAddress();\n  // If funder address is not given, use the signer address\n  const maker = funderAddress === undefined ? eoaSignerAddress : funderAddress;\n  const clobContracts = (0, order_utils_1.getContracts)(chainId);\n  const orderData = yield (0, exports.buildOrderCreationArgs)(eoaSignerAddress, maker, signatureType, userOrder);\n  return (0, exports.buildOrder)(eoaSigner, clobContracts.Exchange, chainId, orderData);\n});\nexports.createOrder = createOrder;\nconst getMarketBuyOrderRawAmounts = (amount, price) => {\n  // force 2 decimals places\n  const rawMakerAmt = (0, utilities_1.roundDown)(amount, 2);\n  const rawPrice = (0, utilities_1.roundDown)(price, 2);\n  let rawTakerAmt = rawMakerAmt / rawPrice;\n  if ((0, utilities_1.decimalPlaces)(rawTakerAmt) > 4) {\n    rawTakerAmt = (0, utilities_1.roundUp)(rawTakerAmt, 8);\n    if ((0, utilities_1.decimalPlaces)(rawTakerAmt) > 4) {\n      rawTakerAmt = (0, utilities_1.roundDown)(rawTakerAmt, 4);\n    }\n  }\n  return {\n    rawMakerAmt,\n    rawTakerAmt\n  };\n};\nexports.getMarketBuyOrderRawAmounts = getMarketBuyOrderRawAmounts;\n/**\n * Translate simple user market order to args used to generate Orders\n */\nconst buildMarketBuyOrderCreationArgs = (signer, maker, signatureType, userMarketOrder) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {\n  const {\n    rawMakerAmt,\n    rawTakerAmt\n  } = (0, exports.getMarketBuyOrderRawAmounts)(userMarketOrder.amount, userMarketOrder.price || 1);\n  const makerAmount = (0, units_1.parseUnits)(rawMakerAmt.toString(), order_utils_1.COLLATERAL_TOKEN_DECIMALS).toString();\n  const takerAmount = (0, units_1.parseUnits)(rawTakerAmt.toString(), order_utils_1.CONDITIONAL_TOKEN_DECIMALS).toString();\n  let taker;\n  if (typeof userMarketOrder.taker !== \"undefined\" && userMarketOrder.taker) {\n    taker = userMarketOrder.taker;\n  } else {\n    taker = \"0x0000000000000000000000000000000000000000\";\n  }\n  let feeRateBps;\n  if (typeof userMarketOrder.feeRateBps !== \"undefined\" && userMarketOrder.feeRateBps) {\n    feeRateBps = userMarketOrder.feeRateBps.toString();\n  } else {\n    feeRateBps = \"0\";\n  }\n  let nonce;\n  if (typeof userMarketOrder.nonce !== \"undefined\" && userMarketOrder.nonce) {\n    nonce = userMarketOrder.nonce.toString();\n  } else {\n    nonce = \"0\";\n  }\n  return {\n    maker,\n    taker,\n    tokenId: userMarketOrder.tokenID,\n    makerAmount,\n    takerAmount,\n    side: order_utils_1.Side.BUY,\n    feeRateBps,\n    nonce,\n    signer,\n    expiration: (userMarketOrder.expiration || 0).toString(),\n    signatureType\n  };\n});\nexports.buildMarketBuyOrderCreationArgs = buildMarketBuyOrderCreationArgs;\nconst createMarketBuyOrder = (eoaSigner, chainId, signatureType, funderAddress, userMarketOrder) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {\n  const eoaSignerAddress = yield eoaSigner.getAddress();\n  // If funder address is not given, use the signer address\n  const maker = funderAddress === undefined ? eoaSignerAddress : funderAddress;\n  const clobContracts = (0, order_utils_1.getContracts)(chainId);\n  const orderData = yield (0, exports.buildMarketBuyOrderCreationArgs)(eoaSignerAddress, maker, signatureType, userMarketOrder);\n  return (0, exports.buildOrder)(eoaSigner, clobContracts.Exchange, chainId, orderData);\n});\nexports.createMarketBuyOrder = createMarketBuyOrder;","map":{"version":3,"names":["units_1","require","order_utils_1","types_1","utilities_1","buildOrder","signer","contractAddress","chainId","orderData","tslib_1","__awaiter","cTFExchangeOrderBuilder","ExchangeOrderBuilder","buildSignedOrder","exports","getOrderAmounts","side","size","price","rawPrice","roundNormal","Side","BUY","rawTakerAmt","roundDown","rawMakerAmt","decimalPlaces","roundUp","SELL","buildOrderCreationArgs","maker","signatureType","userOrder","makerAmount","parseUnits","toString","COLLATERAL_TOKEN_DECIMALS","takerAmount","CONDITIONAL_TOKEN_DECIMALS","taker","feeRateBps","nonce","tokenId","tokenID","expiration","createOrder","eoaSigner","funderAddress","eoaSignerAddress","getAddress","undefined","clobContracts","getContracts","Exchange","getMarketBuyOrderRawAmounts","amount","buildMarketBuyOrderCreationArgs","userMarketOrder","createMarketBuyOrder"],"sources":["../../src/order-builder/helpers.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}